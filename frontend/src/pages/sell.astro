---
// Sell page - Create and list NFTs
import Layout from '../layouts/Layout.astro';
import SolanaWallet from '../components/solana/SolanaWallet.astro';
import NFTCard from '../components/solana/NFTCard.astro';

// Mock user's NFTs for sale
const userNFTs = [
  {
    id: 1,
    name: "My Digital Art #001",
    price: 2.5,
    image: "https://images.unsplash.com/photo-1634017839464-5c339ebe3cb4?w=300&h=200&fit=crop&crop=center",
    description: "Unique digital artwork I created",
    status: "draft",
    minted: false
  },
  {
    id: 2,
    name: "Gaming Collectible",
    price: 1.8,
    image: "https://images.unsplash.com/photo-1634017839464-5c339ebe3cb4?w=300&h=200&fit=crop&crop=center",
    description: "Rare gaming item from my collection",
    status: "listed",
    minted: true
  },
  {
    id: 3,
    name: "Music NFT Album",
    price: 5.0,
    image: "https://images.unsplash.com/photo-1634017839464-5c339ebe3cb4?w=300&h=200&fit=crop&crop=center",
    description: "My latest music album as NFT",
    status: "draft",
    minted: false
  }
];

const stats = {
  totalListings: 12,
  totalSales: 8,
  totalRevenue: 45.2,
  activeListings: 4
};
---

<Layout title="Sell - Soladia Marketplace">
  <main class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
          <div>
            <h1 class="text-3xl font-bold text-gray-900">Sell Your NFTs</h1>
            <p class="mt-2 text-gray-600">Create, mint, and list your digital assets</p>
          </div>
          <div class="mt-4 md:mt-0">
            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
              Create New NFT
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center">
            <div class="p-2 bg-blue-100 rounded-lg">
              <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Total Listings</p>
              <p class="text-2xl font-bold text-gray-900">{stats.totalListings}</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center">
            <div class="p-2 bg-green-100 rounded-lg">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Total Sales</p>
              <p class="text-2xl font-bold text-gray-900">{stats.totalSales}</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center">
            <div class="p-2 bg-yellow-100 rounded-lg">
              <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
              </svg>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Total Revenue</p>
              <p class="text-2xl font-bold text-gray-900">{stats.totalRevenue} SOL</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-sm p-6">
          <div class="flex items-center">
            <div class="p-2 bg-purple-100 rounded-lg">
              <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div class="ml-4">
              <p class="text-sm font-medium text-gray-600">Active Listings</p>
              <p class="text-2xl font-bold text-gray-900">{stats.activeListings}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Wallet Connection -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Wallet Connection</h3>
            <SolanaWallet />
          </div>

          <!-- Quick Actions -->
          <div class="mt-6 bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
            <div class="space-y-3">
              <button class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                Create New NFT
              </button>
              <button class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                Mint Collection
              </button>
              <button class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                Set Up Auction
              </button>
              <button class="w-full bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                View Analytics
              </button>
            </div>
          </div>
        </div>

        <!-- NFT Management -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-lg shadow-sm">
            <div class="px-6 py-4 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900">Your NFTs</h3>
                <div class="flex space-x-2">
                  <button class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                    All
                  </button>
                  <button class="px-3 py-1 text-sm text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">
                    Drafts
                  </button>
                  <button class="px-3 py-1 text-sm text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">
                    Listed
                  </button>
                  <button class="px-3 py-1 text-sm text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">
                    Sold
                  </button>
                </div>
              </div>
            </div>

            <div class="p-6">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {userNFTs.map(nft => (
                  <div class="border border-gray-200 rounded-lg p-4">
                    <div class="aspect-w-16 aspect-h-9 mb-4">
                      <img 
                        src={nft.image} 
                        alt={nft.name}
                        class="w-full h-48 object-cover rounded-lg"
                      />
                    </div>
                    <h4 class="font-semibold text-gray-900 mb-2">{nft.name}</h4>
                    <p class="text-sm text-gray-600 mb-3">{nft.description}</p>
                    <div class="flex items-center justify-between mb-4">
                      <span class="text-lg font-bold text-gray-900">{nft.price} SOL</span>
                      <span class={`px-2 py-1 text-xs rounded-full ${
                        nft.status === 'listed' 
                          ? 'bg-green-100 text-green-800'
                          : 'bg-yellow-100 text-yellow-800'
                      }`}>
                        {nft.status}
                      </span>
                    </div>
                    <div class="flex space-x-2">
                      {!nft.minted ? (
                        <button class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                          Mint NFT
                        </button>
                      ) : (
                        <button class="flex-1 bg-green-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-green-700 transition-colors">
                          List for Sale
                        </button>
                      )}
                      <button class="px-3 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm hover:bg-gray-50 transition-colors">
                        Edit
                      </button>
                    </div>
                  </div>
                ))}
              </div>

              <!-- Empty State -->
              {userNFTs.length === 0 && (
                <div class="text-center py-12">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <h3 class="mt-2 text-sm font-medium text-gray-900">No NFTs yet</h3>
                  <p class="mt-1 text-sm text-gray-500">Get started by creating your first NFT.</p>
                  <div class="mt-6">
                    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                      Create Your First NFT
                    </button>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script>
  // Add client-side functionality for NFT management
  document.addEventListener('DOMContentLoaded', () => {
    // Handle filter buttons
    const filterButtons = document.querySelectorAll('button[class*="px-3 py-1"]');
    filterButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        // Remove active state from all buttons
        filterButtons.forEach(btn => {
          btn.classList.remove('bg-gray-100', 'text-gray-700');
          btn.classList.add('text-gray-600');
        });
        
        // Add active state to clicked button
        (e.target as HTMLButtonElement).classList.add('bg-gray-100', 'text-gray-700');
        (e.target as HTMLButtonElement).classList.remove('text-gray-600');
        
        console.log('Filter changed:', (e.target as HTMLButtonElement).textContent);
        // In a real implementation, this would filter the NFTs
      });
    });

    // Handle action buttons
    const actionButtons = document.querySelectorAll('button[class*="bg-blue-600"], button[class*="bg-green-600"]');
    actionButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const action = (e.target as HTMLButtonElement).textContent?.trim() || '';
        console.log('Action clicked:', action);
        
        // In a real implementation, this would trigger the appropriate action
        if (action === 'Mint NFT') {
          alert('Minting NFT... (This would open a minting modal)');
        } else if (action === 'List for Sale') {
          alert('Listing NFT for sale... (This would open a listing modal)');
        }
      });
    });
  });
</script>
