---
// Dynamic product detail page
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';
import SolanaWallet from '../../components/solana/SolanaWallet.astro';
import PaymentModal from '../../components/solana/PaymentModal.astro';
import NFTCard from '../../components/solana/NFTCard.astro';
import SocialTrading from '../../components/SocialTrading.astro';

export async function getStaticPaths() {
  // Generate paths for demo products
  const products = Array.from({ length: 20 }, (_, i) => ({
    params: { id: (i + 1).toString() }
  }));
  return products;
}

const { id } = Astro.params;

// Mock product data
const product = {
  id: parseInt(id),
  name: `Digital Art NFT #${id}`,
  price: 2.5 + (parseInt(id) * 0.1),
  image: `/api/placeholder/600/400`,
  category: "Digital Art",
  seller: {
    username: "Artist123",
    avatar: "/api/placeholder/40/40",
    verified: true,
    rating: 4.8,
    sales: 156
  },
  description: "This is a unique digital artwork created using advanced AI algorithms. Each piece is one-of-a-kind and represents the intersection of technology and creativity. The artwork features vibrant colors, intricate patterns, and a modern aesthetic that makes it perfect for digital displays or as a collectible item.",
  nft: true,
  solana: true,
  attributes: [
    { trait_type: "Color", value: "Blue" },
    { trait_type: "Style", value: "Abstract" },
    { trait_type: "Rarity", value: "Rare" },
    { trait_type: "Year", value: "2024" },
    { trait_type: "Artist", value: "AI Creator" }
  ],
  collection: {
    name: "Digital Dreams Collection",
    description: "A curated collection of AI-generated digital artworks",
    floor_price: 1.8,
    total_supply: 1000,
    items: 156
  },
  history: [
    { event: "Minted", price: 0, date: "2024-01-15", user: "Artist123" },
    { event: "Listed", price: 2.5, date: "2024-01-16", user: "Artist123" },
    { event: "Bid", price: 2.3, date: "2024-01-17", user: "Collector456" },
    { event: "Bid", price: 2.4, date: "2024-01-18", user: "ArtLover789" }
  ],
  similar_items: [
    {
      id: parseInt(id) + 1,
      name: `Digital Art NFT #${parseInt(id) + 1}`,
      price: 2.8,
      image: `/api/placeholder/200/200`,
      category: "Digital Art"
    },
    {
      id: parseInt(id) + 2,
      name: `Digital Art NFT #${parseInt(id) + 2}`,
      price: 1.9,
      image: `/api/placeholder/200/200`,
      category: "Digital Art"
    },
    {
      id: parseInt(id) + 3,
      name: `Digital Art NFT #${parseInt(id) + 3}`,
      price: 3.2,
      image: `/api/placeholder/200/200`,
      category: "Digital Art"
    }
  ]
};

const currentBid = 2.4;
const minBid = 2.5;
const timeLeft = "2d 14h 32m";
---

<Layout title={`${product.name} - Soladia Marketplace`}>
  <main class="min-h-screen bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Product Info -->
        <div class="lg:col-span-2">
          <!-- Product Image -->
          <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-6">
            <div class="aspect-w-16 aspect-h-9">
              <img 
                src={product.image} 
                alt={product.name}
                class="w-full h-96 object-cover"
              />
            </div>
          </div>

          <!-- Product Details -->
          <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="flex items-start justify-between mb-4">
              <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">{product.name}</h1>
                <div class="flex items-center space-x-4">
                  <span class="text-2xl font-bold text-blue-600">{product.price} SOL</span>
                  <span class="text-sm text-gray-500">≈ $95.50</span>
                </div>
              </div>
              <div class="flex space-x-2">
                <button class="p-2 text-gray-400 hover:text-red-500 transition-colors">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                  </svg>
                </button>
                <button class="p-2 text-gray-400 hover:text-blue-500 transition-colors">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Seller Info -->
            <div class="flex items-center space-x-3 mb-6">
              <img 
                src={product.seller.avatar} 
                alt={product.seller.username}
                class="w-12 h-12 rounded-full"
              />
              <div>
                <div class="flex items-center space-x-2">
                  <span class="font-medium text-gray-900">{product.seller.username}</span>
                  {product.seller.verified && (
                    <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                  )}
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-500">
                  <span>⭐ {product.seller.rating}</span>
                  <span>•</span>
                  <span>{product.seller.sales} sales</span>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-2">Description</h3>
              <p class="text-gray-600">{product.description}</p>
            </div>

            <!-- Attributes -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Attributes</h3>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                {product.attributes.map(attr => (
                  <div class="bg-gray-50 rounded-lg p-3">
                    <div class="text-sm text-gray-500">{attr.trait_type}</div>
                    <div class="font-medium text-gray-900">{attr.value}</div>
                  </div>
                ))}
              </div>
            </div>

            <!-- Collection Info -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Collection</h3>
              <div class="bg-gray-50 rounded-lg p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h4 class="font-medium text-gray-900">{product.collection.name}</h4>
                    <p class="text-sm text-gray-600">{product.collection.description}</p>
                  </div>
                  <div class="text-right">
                    <div class="text-sm text-gray-500">Floor Price</div>
                    <div class="font-medium text-gray-900">{product.collection.floor_price} SOL</div>
                  </div>
                </div>
                <div class="mt-3 flex items-center space-x-4 text-sm text-gray-500">
                  <span>{product.collection.items} items</span>
                  <span>•</span>
                  <span>{product.collection.total_supply} total supply</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Similar Items -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Similar Items</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {product.similar_items.map((item: any) => (
                <ProductCard 
                  product={item}
                  showSolana={true}
                  showNFT={true}
                />
              ))}
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <!-- Purchase Section -->
          <div class="bg-white rounded-lg shadow-sm p-6 mb-6 sticky top-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Purchase</h3>
            
            <!-- Current Price -->
            <div class="text-center mb-6">
              <div class="text-3xl font-bold text-gray-900">{product.price} SOL</div>
              <div class="text-sm text-gray-500">≈ $95.50 USD</div>
            </div>

            <!-- Wallet Connection -->
            <div class="mb-6">
              <SolanaWallet />
            </div>

            <!-- Purchase Buttons -->
            <div class="space-y-3">
              <button 
                class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                id="buy-now-btn"
              >
                Buy Now
              </button>
              <button 
                class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors"
                id="make-offer-btn"
              >
                Make Offer
              </button>
              <button 
                class="w-full border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors"
                id="add-to-cart-btn"
              >
                Add to Cart
              </button>
            </div>

            <!-- Auction Info -->
            <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-yellow-800">Current Bid</span>
                <span class="text-sm font-bold text-yellow-900">{currentBid} SOL</span>
              </div>
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm font-medium text-yellow-800">Minimum Bid</span>
                <span class="text-sm font-bold text-yellow-900">{minBid} SOL</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-yellow-800">Time Left</span>
                <span class="text-sm font-bold text-yellow-900">{timeLeft}</span>
              </div>
            </div>
          </div>

          <!-- Social Trading -->
          <div class="mb-6">
            <SocialTrading 
              showLeaderboard={false}
              showSocialFeed={true}
              showCopyTrading={false}
              showCommunity={false}
            />
          </div>

          <!-- Price History -->
          <div class="bg-white rounded-lg shadow-sm p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Price History</h3>
            <div class="space-y-3">
              {product.history.map((event, index) => (
                <div class="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
                  <div>
                    <div class="text-sm font-medium text-gray-900">{event.event}</div>
                    <div class="text-xs text-gray-500">{event.date}</div>
                  </div>
                  <div class="text-right">
                    <div class="text-sm font-medium text-gray-900">
                      {event.price > 0 ? `${event.price} SOL` : 'Free'}
                    </div>
                    <div class="text-xs text-gray-500">{event.user}</div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Modal -->
    <PaymentModal />
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Purchase buttons
    const buyNowBtn = document.getElementById('buy-now-btn');
    const makeOfferBtn = document.getElementById('make-offer-btn');
    const addToCartBtn = document.getElementById('add-to-cart-btn');

    buyNowBtn?.addEventListener('click', () => {
      console.log('Buy now clicked');
      // In a real implementation, this would open the payment modal
      alert('Buy now functionality will be implemented with Solana payment processing');
    });

    makeOfferBtn?.addEventListener('click', () => {
      console.log('Make offer clicked');
      // In a real implementation, this would open an offer modal
      alert('Make offer functionality will be implemented with auction system');
    });

    addToCartBtn?.addEventListener('click', () => {
      console.log('Add to cart clicked');
      // In a real implementation, this would add to cart
      alert('Item added to cart!');
    });

    // Social interactions
    const likeBtn = document.querySelector('button[class*="hover:text-red-500"]');
    const shareBtn = document.querySelector('button[class*="hover:text-blue-500"]');

    likeBtn?.addEventListener('click', () => {
      console.log('Like clicked');
      // In a real implementation, this would toggle like status
    });

    shareBtn?.addEventListener('click', () => {
      console.log('Share clicked');
      // In a real implementation, this would open share options
      if (navigator.share) {
        navigator.share({
          title: document.title,
          text: 'Check out this NFT on Soladia!',
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        alert('Link copied to clipboard!');
      }
    });
  });
</script>